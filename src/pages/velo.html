<!doctype html>
<html lang="ru" class="a-fullscreen">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="robots" content="noindex,nofollow,noarchive"/>
    <meta name="yandex-verification" content="c74167eb0fd8f8fe" />
        <meta name="yandex" content="noindex,nofollow,noarchive"/>
        <meta name="googlebot" content="noindex,nofollow,noarchive"/>
<!--    <link rel="shortcut icon" href="https://garage-codd.ru/favicon.ico"/>-->
    <link rel="apple-touch-icon" sizes="180x180" href="https://garage-codd.ru/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://garage-codd.ru/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://garage-codd.ru/favicons/favicon-16x16.png">
    <link rel="manifest" href="https://garage-codd.ru/favicons/site.webmanifest">
    <link rel="mask-icon" href="https://garage-codd.ru/favicons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#090909">
    <!--    &lt;!&ndash; Primary Meta Tags &ndash;&gt;-->
    <!--    <meta name="title" content="Гараж ЦОДД"/>-->
    <!--    <meta name="description" content="Гараж ЦОДД"/>-->
    <!--    <meta name="keywords" content="Гараж ЦОДД"/>-->

    <!--    &lt;!&ndash; Open Graph / Facebook &ndash;&gt;-->
    <!--    <meta property="og:type" content="website"/>-->
    <!--    <meta property="og:url" content="https://garage-codd.ru/"/>-->
    <!--    <meta property="og:title" content="Гараж ЦОДД"/>-->
    <!--    <meta property="og:description" content="Гараж ЦОДД"/>-->
    <!--    <meta property="og:image" content="https://garage-codd.ru/seo.png"/>-->

    <!--    &lt;!&ndash; Twitter &ndash;&gt;-->
    <!--    <meta property="twitter:card" content="summary_large_image"/>-->
    <!--    <meta property="twitter:url" content="https://garage-codd.ru/"/>-->
    <!--    <meta property="twitter:title" content="Гараж ЦОДД"/>-->
    <!--    <meta property="twitter:description" content="Гараж ЦОДД"/>-->
    <!--    <meta property="twitter:image" content="https://garage-codd.ru/seo.png"/>-->
    <title>Гараж ЦОДД</title>
    <link rel="stylesheet" href="../style/style.css">
    <script defer src="https://cdn.jsdelivr.net/npm/swiper@8/swiper-bundle.min.js"></script>
</head>
<body>

<div class="progress-bar">
    <div class="progress-bar-container">
        <div class="image">
            <img class="no_animated" src="/src/img/layout/loader/logo.gif" alt="цодд">
        </div>
        <span id="progress-label">0%</span>
        <div id="hellopreloader_barWrapper">
            <progress id="progress-bar" value="0" max="100"></progress>
        </div>
        <label for="progress-bar" id="progress_text">Загрузка...</label>
    </div>
</div>

<div class="header">
    <a class="header__logo" href="../index.html#velo_patrol">
        <img class="header__logo-img" src="../img/layout/header_logo.svg" alt="logo">
        <p class="header__logo-text">Гараж ЦОДД</p>
    </a>
</div>

<div class="tech_spec active">
    <div class="tech_spec__wrapper hidden">
        <div class="tech_spec__description hidden">
            <div class="tech_spec__description-grid_wrapper hidden">
                <div class="tech_spec__titles hidden">
                    <div class="text_spec__texts">
                        <p class="tech_spec__title">Велопатруль</p>
                        <!--                                <p class="tech_spec__subtitle">Помощь водителям на&nbsp;базе мобильных комплексов фотовидеофиксации</p>-->
                    </div>
                </div>
                <div class="tech_spec__mission hidden">
                    <div class="tech_spec__mission-panel">
                        <p class="tech_spec__text">Задача</p>
                        <div class="tech_spec__mission-panel-background"></div>
                    </div>
                    <p class="tech_spec__text-descr">В&nbsp;теплое время года помогает велосипедистам, водителям и&nbsp;пешеходам</p>
                </div>
                <div class="tech_spec__outfit hidden">
                    <div class="tech_spec__outfit-panel">
                        <p class="tech_spec__text">Экипировка</p>
                        <div class="tech_spec__outfit-panel-background"></div>
                    </div>
                    <ul class="tech_spec__outfit-list">
                        <li class="tech_spec__outfit-item">
                            <div class="tech_spec__outfit-img">
                                <img src="../img/layout/outfit/amarok/outfit_1.svg" alt="Огнетушитель" fetchpriority="high">
                            </div>
                            <span class="tech_spec__outfit-text">Огнетушитель</span>
                        </li>
                        <li class="tech_spec__outfit-item">
                            <div class="tech_spec__outfit-img">
                                <img src="../img/layout/outfit/amarok/outfit_2.svg" alt="Аптечка" fetchpriority="high">
                            </div>
                            <span class="tech_spec__outfit-text">Аптечка</span>
                        </li>
                        <li class="tech_spec__outfit-item">
                            <div class="tech_spec__outfit-img">
                                <img src="../img/layout/outfit/amarok/outfit_3.svg" alt="Инструменты" fetchpriority="high">
                            </div>
                            <span class="tech_spec__outfit-text">Инструменты</span>
                        </li>
                        <li class="tech_spec__outfit-item">
                            <div class="tech_spec__outfit-img">
                                <img src="../img/layout/outfit/amarok/outfit_7.svg" alt="Бланки европротокола" fetchpriority="high">
                            </div>
                            <span class="tech_spec__outfit-text">Бланки европротокола</span>
                        </li>
                        <li class="tech_spec__outfit-item">
                            <div class="tech_spec__outfit-img">
                                <img src="../img/layout/outfit/velo/outfit_1.svg" alt="Вода" fetchpriority="high">
                            </div>
                            <span class="tech_spec__outfit-text">Вода</span>
                        </li>
                        <li class="tech_spec__outfit-item">
                            <div class="tech_spec__outfit-img">
                                <img src="../img/layout/outfit/velo/outfit_2.svg" alt="Приложение «Помощник Москвы»" fetchpriority="high">
                            </div>
                            <span class="tech_spec__outfit-text">Приложение «Помощник Москвы»</span>
                        </li>
                        <li class="tech_spec__outfit-item">
                            <div class="tech_spec__outfit-img">
                                <img src="../img/layout/outfit/solaris_gray/outfit_12.svg" alt="Жезл регулировщика" fetchpriority="high">
                            </div>
                            <span class="tech_spec__outfit-text">Жезл регулировщика</span>
                        </li>
                    </ul>
                </div>
                <div class="tech_spec__button">
                    <a class="tech_spec__btn">
                        <span>Подробнее</span>
<!--                        <span>Скрыть</span>-->
                        <img src="../img/layout/icon-arrow.svg" alt="icon-arrow" fetchpriority="high">
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="tech_spec__interior" id="velo">
    <p class="tech_spec__interior-title">Велосипед</p>
    <div class="tech_spec__interior-wrapper">
        <div class="tech_spec__interior-btn">
            <span class="tech_spec__interior-text">В салон</span>
            <div class="arrow-wrapper">
                <img src="../img/layout/interior_arrow.svg" alt="interior_arrow">
            </div>
        </div>
    </div>
</div>

<div class="auto_park">
    <div class="container">
        <div class="auto_park_wrapper">
            <div class="auto_park__control">
                <p class="auto_park__title">Транспорт ЦОДД</p>
                <img class="rotate" src="../img/layout/auto_park_arrow.svg" alt="auto_park_btn">
            </div>
            <div class="auto_park_slider">
                <div class="auto_park_slider-overflow swiper_model">
                    <div class="auto_park_slider-wrapper swiper-wrapper">
                        <div class="gallery_item swiper-slide">
                            <a class="gallery_item_link" href="amarok.html">
                                <picture>
<!--                                    <source srcset="../img/layout/pages/main/slider/amarok.webp" type="image/webp">-->
                                    <img class="gallery_item-img" src="../img/layout/pages/main/slider/amarok.png" alt="amarok" fetchpriority="high">
                                </picture>
                                <!--                                <img class="gallery_item-img" src="../img/layout/pages/main/slider/amarok.png" alt="amarok">-->
                            </a>
                        </div>
                        <div class="gallery_item swiper-slide">
                            <a class="gallery_item_link" href="ford.html">
                                <picture>
<!--                                    <source srcset="../img/layout/pages/main/slider/ford.webp" type="image/webp">-->
                                    <img class="gallery_item-img" src="../img/layout/pages/main/slider/ford.png" alt="ford" fetchpriority="high">
                                </picture>
                                <!--                                <img class="gallery_item-img" src="../img/layout/pages/main/slider/ford.png" alt="ford">-->
                            </a>
                        </div>
                        <div class="gallery_item swiper-slide">
                            <a class="gallery_item_link" href="kater.html">
                                <picture>
<!--                                    <source srcset="../img/layout/pages/main/slider/kater.webp" type="image/webp">-->
                                    <img class="gallery_item-img" src="../img/layout/pages/main/slider/kater.png" alt="kater" fetchpriority="high">
                                </picture>
                                <img class="gallery_item-img" src="../img/layout/pages/main/slider/kater.png" alt="kater">
                            </a>
                        </div>
                        <div class="gallery_item swiper-slide">
                            <a class="gallery_item_link" href="solaris_two.html">
                                <picture>
<!--                                    <source srcset="../img/layout/pages/main/slider/solaris_gray.webp" type="image/webp">-->
                                    <img class="gallery_item-img" src="../img/layout/pages/main/slider/solaris_gray.png" alt="solaris" fetchpriority="high">
                                </picture>
                                <!--                                <img class="gallery_item-img" src="../img/layout/pages/main/slider/solaris_gray.png" alt="solaris">-->
                            </a>
                        </div>
                        <div class="gallery_item swiper-slide">
                            <a class="gallery_item_link" href="bus.html">
                                <picture>
<!--                                    <source srcset="../img/layout/pages/main/slider/bus.webp" type="image/webp">-->
                                    <img class="gallery_item-img" src="../img/layout/pages/main/slider/bus.png" alt="bus" fetchpriority="high">
                                </picture>
                                <!--                                <img class="gallery_item-img" src="../img/layout/pages/main/slider/bus.png" alt="bus">-->
                            </a>
                        </div>
                        <div class="gallery_item swiper-slide">
                            <a class="gallery_item_link" href="moskvich.html">
                                <picture>
<!--                                    <source srcset="../img/layout/pages/main/slider/moskvich.webp" type="image/webp">-->
                                    <img class="gallery_item-img" src="../img/layout/pages/main/slider/moskvich.png" alt="moskvich" fetchpriority="high">
                                </picture>
                                <!--                                <img class="gallery_item-img" src="../img/layout/pages/main/slider/moskvich.png" alt="moskvich">-->
                            </a>
                        </div>
                        <div class="gallery_item swiper-slide active">
                            <a class="gallery_item_link" href="velo.html">
                                <picture>
<!--                                    <source srcset="../img/layout/pages/main/slider/velo.webp" type="image/webp">-->
                                    <img class="gallery_item-img" src="../img/layout/pages/main/slider/velo.png" alt="velo" fetchpriority="high">
                                </picture>
                                <!--                                <img class="gallery_item-img" src="../img/layout/pages/main/slider/velo.png" alt="velo">-->
                            </a>
                        </div>
                    </div>
                </div>
                <div class="auto_park_slider-button">
                    <button class="prev_button">
                        <img src="../img/layout/slider/icon-arrow.png" alt="arrow_prev" fetchpriority="high">
                    </button>
                    <button class="next_button">
                        <img src="../img/layout/slider/icon-arrow.png" alt="arrow_next" fetchpriority="high">
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<iframe id="9f0e8cf5-2302-46a3-8e49-0a7c4c3911d8" src="" width="100%" height="100%" class="VectaryIframe"></iframe>
<div id="overlay"></div>

<script type="module">
    import { VctrModelApi } from "https://app.vectary.com/studio-lite/scripts/api.js";
    let isModelLoaded = false;

    const LOADING_TIME = 50000;
    const PERCENT_STEP = 2;
    const COUNT_LOAD_TIME = LOADING_TIME / (100 / PERCENT_STEP);
    let percent = 0;
    let preloader = document.querySelector(".progress-bar");
    const percentEl = document.getElementById("progress-label");
    const barEl = document.getElementById("progress-bar");
    let progressText = document.getElementById("progress_text");

    function fadeOutnojquery(el) {
        el.style.opacity = 1;
        let interhellopreloader = setInterval(function () {
            el.style.opacity = el.style.opacity - 0.05;

            if (el.style.opacity <= 0.05) {
                clearInterval(interhellopreloader);
                preloader.style.display = "none";
            }
        }, 16);
    }

    function countLoad() {
        barEl.style.width = "0%";
        percentEl.textContent = `0%`;
        barEl.style.transition = `width ${COUNT_LOAD_TIME / 4000}s linear`;

        let countInterval = setInterval(function () {
            percent += PERCENT_STEP;

            if ((percent > 96) && !isModelLoaded) {
                percent = 98;
            } else {
                if (percent > 100) {
                    percent = 100;
                }
            }

            percentEl.textContent = `${percent}%`;
            barEl.style.width = `${percent}%`;

            if (percent >= 25 && percent < 50) {
                progressText.textContent = 'Подбираем экипаж...';
            } else if (percent >= 50 && percent < 70) {
                progressText.textContent = 'Проводим ТО...';
            } else if (percent >= 70 && percent < 90) {
                progressText.textContent = 'Намываем технику...';
            } else if (percent >= 80) {
                progressText.textContent = 'Экипируемся...';
            }
            if (isModelLoaded) {
                clearInterval(countInterval);
                let acceleratedInterval = COUNT_LOAD_TIME / 0;
                countInterval = setInterval(function () {
                    percent += PERCENT_STEP;

                    if (percent > 100) {
                        percent = 100;
                    }

                    percentEl.textContent = `${percent}%`;
                    barEl.style.width = `${percent}%`;

                    if (percent === 100) {
                        progressText.textContent = 'Мы готовы!';
                        setTimeout(function () {
                            fadeOutnojquery(preloader);
                        }, 500);
                        clearInterval(countInterval);
                    }
                }, acceleratedInterval);
            }
        }, COUNT_LOAD_TIME);
    }

    countLoad();

    function myLoading(url) {
        console.log('myLoading go!');
        let xhr = new XMLHttpRequest();
        xhr.open('GET', url);
        xhr.send();
        const startTime = new Date().getTime(); // Запоминаем время начала загрузки

        // 4. Эта функция будет вызвана после получения ответа
        xhr.onload = function() {
            if (xhr.status !== 200) { // анализ HTTP-статуса ответа
                console.log(`Error ${xhr.status}: ${xhr.statusText}`); // e.g. 404: Not Found
            } else {
                // console.log(`Done, got ${xhr.response.length} bytes`); // response - ответ сервера
                const endTime = new Date().getTime(); // Запоминаем время завершения загрузки
                const fileSizeInBytes = xhr.response.length;
                const fileSizeInMegabytes = fileSizeInBytes / (1024 * 1024); // Преобразование в мегабайты
                const downloadTimeInSeconds = (endTime - startTime) / 1000; // Преобразование в секунды

                console.log(`Done, got ${fileSizeInMegabytes.toFixed(1)} MB in ${downloadTimeInSeconds.toFixed(1)} seconds`);
                setTimeout(() => {
                    isModelLoaded = true;
                }, 10000);
            }
        };
        // UNSENT = 0; // initial state
        // OPENED = 1; // open called
        // HEADERS_RECEIVED = 2; // полученные заголовки ответа
        // LOADING = 3; // происходит загрузка ответа (получен пакет данных)
        // DONE = 4; // запрос выполнен
        // xhr.onreadystatechange = function() {
        //     if (xhr.readyState == 4) {
        //         console.log('запрос выполнен');
        //     }
        // };
        xhr.onerror = function() {
            console.log("Request failed");
        };
    }

    const IframeObject = {
        AR_ON: 'https://www.vectary.com/p/1OaMXKivHNjDz5dAVF1jAI',
        AR_OFF: 'https://www.vectary.com/p/3m2dU1xt6Dmw4b4RY71iN7',
        XHR_AR_ON: 'https://app.vectary.com/api/vctr-repo/v2/dependencies/f5804f89-c08b-4b41-82cd-89f109f856b6/f5804f89-c08b-4b41-82cd-89f109f856b6',
        XHR_AR_OFF: 'https://app.vectary.com/api/vctr-repo/v2/dependencies/e92374b7-1f26-41bc-ba69-239509c8643c/e92374b7-1f26-41bc-ba69-239509c8643c'
    };
    let viewerApi = new VctrModelApi("9f0e8cf5-2302-46a3-8e49-0a7c4c3911d8"); // DOM Id
    let screenWidth = window.innerWidth;
    let xhrFile;
    let readySRC;

    if (screenWidth >= 700 && screenWidth <= 1200) {
        readySRC = IframeObject.AR_OFF;
        xhrFile = IframeObject.XHR_AR_OFF;
    } else if (screenWidth < 700) {
        readySRC = IframeObject.MOBILE_AR_ON;
        xhrFile = IframeObject.XHR_MOBILE_AR_ON;
    } else {
        readySRC = IframeObject.AR_ON;
        xhrFile = IframeObject.XHR_AR_ON;
    }

    async function initializeModelApi() {
        console.log('API go!');
        try {
            // Вызываем несуществующий метод, что приведет к ошибке (для теста)
            // await viewerApi.nonExistentMethod();
            await viewerApi.init();
            viewerApi.isReady().then(() => {
                isModelLoaded = true;
                console.log('Model loaded');
            });
        } catch (error) {
            console.error('Ошибка внутри API:', error);
            myLoading(xhrFile);
        }
    }

    document.addEventListener("DOMContentLoaded", () => {
        let VectaryIframe = document.querySelector('.VectaryIframe');
        VectaryIframe.src = readySRC;
        initializeModelApi();
    });
</script>
</body>
</html>