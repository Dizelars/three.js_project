<!doctype html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Гараж ЦОДД</title>
    <meta name="description" content="Smooth Cam movement"/>
    <link rel="stylesheet" href="../style/style.css">
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script>
        AFRAME.registerComponent("hotspots", {
            init: function () {
                this.el.addEventListener("reloadspots", function (evt) {
                    //get the entire current spot group and scale it to 0
                    var currspotgroup = document.getElementById(evt.detail.currspots);
                    currspotgroup.setAttribute("scale", "0 0 0");

                    //get the entire new spot group and scale it to 1
                    var newspotgroup = document.getElementById(evt.detail.newspots);
                    newspotgroup.setAttribute("scale", "1 1 1");
                });
            }
        });

        AFRAME.registerComponent("spot", {
            schema: {
                linkto: { type: "string", default: "" },
                spotgroup: { type: "string", default: "" },
                phiStart: { type: "string", default: "" }
            },
            init: function () {
                //add image source of hotspot icon
                // this.el.setAttribute("src", "#hotspot");
                //make the icon look at the camera all the time
                // this.el.setAttribute("look-at", "#cam");

                this.el.addEventListener("click", () => {
                    var cam = document.getElementById("cam");
                    cam.emit("zoomin");

                    var fp = document.getElementById("camfadeplane");
                    fp.setAttribute("width", "2");
                    fp.setAttribute("height", "2");
                    fp.emit("camFadeIn");

                    //alert("Start zoom");

                    const reloadSpot = () => {
                        //set the skybox source to the new image as per the spot
                        var sky = document.getElementById("skybox");
                        sky.setAttribute("src", this.data.linkto);
                        //надобавлял говна но оно не пашет
                        sky.setAttribute("phi-start", this.data.phiStart);

                        var spotcomp = document.getElementById("spots");
                        var currspots = this.el.parentElement.getAttribute("id");
                        //create event for spots component to change the spots data
                        spotcomp.emit("reloadspots", {
                            newspots: this.data.spotgroup,
                            currspots: currspots
                        });

                        //this.setAttribute("camera","fov",80);
                        cam.emit("zoomout");

                        var fp = document.getElementById("camfadeplane");
                        fp.emit("camFadeOut");

                        setTimeout(() => {
                            fp.setAttribute("width", "0");
                            fp.setAttribute("height", "0");
                        }, 1000);
                    };
                    setTimeout(reloadSpot, 2000);
                });

                // this.el.addEventListener("mouseleave", function () {
                //   var cur = document.getElementById("cursor-visual");
                //   cur.emit("stopFuse");
                // });

                //поменял mouseenter на click. какая то хуйня
                // this.el.addEventListener("click", function (evt) {
                //   var cur = document.getElementById("cursor-visual");
                //   cur.emit("startFuse");
                // });
            }
        });
    </script>
</head>
<body>

<div class="progress-bar">
    <div class="progress-bar-container">
        <div class="image">
            <!--            <img class="animated" src="/src/img/layout/loader/2.svg" alt="цодд">-->
            <!--            <p class="image-text">ЦОДД</p>-->
            <img class="no_animated" src="/src/img/layout/loader/logo.gif" alt="цодд">
            <!--            <video autoplay muted loop playsinline preload>-->
            <!--                <source src="/src/img/layout/loader/logo.mp4" type="video/mp4">-->
            <!--                <source src="/src/img/layout/loader/logo.webm" type="video/webm">-->
            <!--            </video>-->
        </div>
        <span id="progress-label">0%</span>
        <div id="hellopreloader_barWrapper">
            <progress id="progress-bar" value="0" max="100"></progress>
        </div>
        <label for="progress-bar" id="progress_text">Загрузка...</label>
    </div>
</div>

<header class="header">
    <div class="container">
        <div class="header__wrapper">
            <a class="header__logo" href="../index.html">
                <img class="header__logo-img" src="../img/layout/header_logo.svg" alt="logo">
                <p class="header__logo-text">Гараж ЦОДД</p>
            </a>
            <div class="header__info">
                <img class="header__info-img" src="../img/layout/header_img2.png" alt="model_preview">
                <div class="header__info-descr">
                    <p class="header__info-text">Дорожный патруль</p>
                    <p class="header__info-text">30 автомобилей</p>
                </div>
            </div>
        </div>
    </div>
</header>

<main>
    <section class="tech_spec">
        <div class="container__content">
            <div class="tech_spec__wrapper">
                <div class="tech_spec__description">
                    <div class="tech_spec__description-grid_wrapper">
                        <div class="tech_spec__titles">
                            <div class="text_spec__texts">
                                <p class="tech_spec__title">Служба помощи</p>
                                <p class="tech_spec__subtitle">Помощь водителям на&nbsp;базе мобильных комплексов фотовидеофиксации</p>
                            </div>
                        </div>
                        <div class="tech_spec__mission">
                            <p class="tech_spec__text">Задача:</p>
                            <p class="tech_spec__text-descr">Помощь тем, кто столкнулся с&nbsp;трудностями на&nbsp;дороге</p>
                        </div>
                        <div class="tech_spec__outfit">
                            <p class="tech_spec__text">Экипировка:</p>
                            <ul class="tech_spec__outfit-list">
                                <li class="tech_spec__outfit-item">
                                    <div class="tech_spec__outfit-img">
                                        <img src="../img/layout/outfit/outfit_1.svg" alt="Огнетушитель">
                                    </div>
                                    <span class="tech_spec__outfit-text">Огнетушитель</span>
                                </li>
                                <li class="tech_spec__outfit-item">
                                    <div class="tech_spec__outfit-img">
                                        <img src="../img/layout/outfit/outfit_2.svg" alt="Аптечка">
                                    </div>
                                    <span class="tech_spec__outfit-text">Аптечка</span>
                                </li>
                                <li class="tech_spec__outfit-item">
                                    <div class="tech_spec__outfit-img">
                                        <img src="../img/layout/outfit/outfit_3.svg" alt="Инструменты">
                                    </div>
                                    <span class="tech_spec__outfit-text">Инструменты</span>
                                </li>
                                <li class="tech_spec__outfit-item">
                                    <div class="tech_spec__outfit-img">
                                        <img src="../img/layout/outfit/outfit_4.svg" alt="Трос">
                                    </div>
                                    <span class="tech_spec__outfit-text">Трос</span>
                                </li>
                                <li class="tech_spec__outfit-item">
                                    <div class="tech_spec__outfit-img">
                                        <img src="../img/layout/outfit/outfit_6.svg" alt="Пусковое устройство">
                                    </div>
                                    <span class="tech_spec__outfit-text">Пусковое устройство</span>
                                </li>
                                <li class="tech_spec__outfit-item">
                                    <div class="tech_spec__outfit-img">
                                        <img src="../img/layout/outfit/outfit_7.svg" alt="Бланки европротокола">
                                    </div>
                                    <span class="tech_spec__outfit-text">Бланки европротокола</span>
                                </li>
                                <li class="tech_spec__outfit-item">
                                    <div class="tech_spec__outfit-img">
                                        <img src="../img/layout/outfit/outfit_8.svg" alt="Телескопическая лестница">
                                    </div>
                                    <span class="tech_spec__outfit-text">Cкладная лестница</span>
                                </li>
                                <li class="tech_spec__outfit-item">
                                    <div class="tech_spec__outfit-img">
                                        <img src="../img/layout/outfit/outfit_9.svg" alt="Домкрат">
                                    </div>
                                    <span class="tech_spec__outfit-text">Домкрат</span>
                                </li>
                                <li class="tech_spec__outfit-item">
                                    <div class="tech_spec__outfit-img">
                                        <img src="../img/layout/outfit/outfit_10.svg" alt="Дорожные конусы">
                                    </div>
                                    <span class="tech_spec__outfit-text">Дорожные конусы</span>
                                </li>
                                <li class="tech_spec__outfit-item">
                                    <div class="tech_spec__outfit-img">
                                        <img src="../img/layout/outfit/outfit_11.svg" alt="Гайковерт">
                                    </div>
                                    <span class="tech_spec__outfit-text">Гайковерт</span>
                                </li>
                                <li class="tech_spec__outfit-item">
                                    <div class="tech_spec__outfit-img">
                                        <img src="../img/layout/outfit/outfit_11.svg" alt="Гайковерт">
                                    </div>
                                    <span class="tech_spec__outfit-text">Гайковерт</span>
                                </li>
                            </ul>
                        </div>
                        <div class="tech_spec__button">
                            <a class="tech_spec__btn">
                                <span>Скрыть</span>
                                <img class="rotate" src="../img/layout/icon-arrow.svg" alt="icon-arrow">
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <div class="tech_spec__interior" id="solaris_gray">
        <div class="tech_spec__interior-btn">
            <span class="tech_spec__interior-text">В салон</span>
            <div class="arrow-wrapper">
                <img src="../img/layout/interior_arrow.svg" alt="interior_arrow">
            </div>
        </div>
    </div>
</main>

<iframe src="https://app.vectary.com/p/3yUUqLuKMivlvJ7atkLNjW" width="100%" height="100%"></iframe>

<section class="auto_park">
    <div class="container">
        <div class="auto_park_wrapper">
            <div class="auto_park__control">
                <p class="auto_park__title">Транспорт ЦОДД</p>
                <img class="rotate" src="../img/layout/auto_park_arrow.svg" alt="auto_park_btn">
            </div>
            <div class="auto_park_slider">
                <div class="auto_park_slider-overflow">
                    <div class="auto_park_slider-wrapper">
                        <div class="gallery_item">
                            <a class="gallery_item_link" href="../pages/amarok.html">
                                <img class="gallery_item-img" src="../img/layout/slider/amarok.png" alt="amarok">
                            </a>
                        </div>
                        <div class="gallery_item">
                            <a class="gallery_item_link" href="../pages/ford.html">
                                <img class="gallery_item-img" src="../img/layout/slider/ford.png" alt="ford">
                            </a>
                        </div>
<!--                        <div class="gallery_item">-->
<!--                            <a class="gallery_item_link" href="../pages/solaris.html">-->
<!--                                <img class="gallery_item-img" src="../img/layout/slider/solaris_green.png" alt="solaris">-->
<!--                            </a>-->
<!--                        </div>-->
                        <div class="gallery_item active">
                            <a class="gallery_item_link" href="#">
                                <img class="gallery_item-img" src="../img/layout/slider/solaris_gray.png" alt="solaris">
                            </a>
                        </div>
                        <div class="gallery_item">
                            <a class="gallery_item_link" href="../pages/bus.html">
                                <img class="gallery_item-img" src="../img/layout/slider/bus.png" alt="bus">
                            </a>
                        </div>
                    </div>
                </div>
                <div class="auto_park_slider-button">
                    <button class="prev_button">
                        <img src="../img/layout/slider/icon-arrow.png" alt="arrow_prev">
                    </button>
                    <button class="next_button">
                        <img src="../img/layout/slider/icon-arrow.png" alt="arrow_next">
                    </button>
                </div>
            </div>
        </div>
    </div>
</section>

<a-scene>
    <a-assets>
        <script id="flatShader" type="x-shader/x-fragment">
          varying vec2 vUv;
          void main() {
            gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);
          }
        </script>
        <!-- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! -->
        <!-- Начало применения правок к коду -->
        <!-- !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! -->

        <img
                id="room1"
                src="https://coddmac.store/codd_garage/360/hyundai_silver/1.jpg"
                crossorigin="anonymous"
                importance="high"
        />
    </a-assets>

    <!-- room teleport hotspots -->

    <a-entity
            id="cam"
            camera="fov:80"
            position="0 1.6 0"
            look-controls
            cursor="rayOrigin: mouse"
            animation__zoomin="property:camera.fov;dur:2000;to:50;startEvents:zoomin;"
            animation__zoomout="property:camera.fov;dur:1000;to:80;startEvents:zoomout;"
    >
        <a-plane
                id="camfadeplane"
                rotation="10 0.5 0"
                position="0 0 -0.5"
                material="color:#000000;transparent:true;opacity:0"
                width="0"
                height="0"
                animation__fadein="property:material.opacity;to:1;dur:2000;startEvents:camFadeIn"
                animation__fadeout="property:material.opacity;to:0;dur:1000;startEvents:camFadeOut"
        ></a-plane>
    </a-entity>

    <!-- тут где написано phi-start подбираем точку начала первого кадра
(куда будет повёрнута камера при загрузке страницы) -->

    <a-sky id="skybox" src="#room1" rotation="0 0 0" phi-start="173"></a-sky>
</a-scene>

<!--<script src="../js/loader.js"></script>-->
<!--<script>-->
<!--    const LOADING_TIME = 20000;-->
<!--    const PERCENT_STEP = 5;-->
<!--    const COUNT_LOAD_TIME = LOADING_TIME / (100 / PERCENT_STEP);-->
<!--    let percent = 0;-->
<!--    let preloader = document.querySelector(".progress-bar");-->
<!--    const percentEl = document.getElementById("progress-label");-->
<!--    const barEl = document.getElementById("progress-bar");-->
<!--    let progressText = document.getElementById("progress_text");-->

<!--    function countLoad() {-->
<!--        barEl.style.width = "0%";-->
<!--        percentEl.textContent = `0%`;-->
<!--        let countInterval = setInterval(function () {-->
<!--            percent += PERCENT_STEP;-->
<!--            percentEl.textContent = `${percent}%`;-->
<!--            barEl.style.width = `${percent}%`;-->
<!--            if (percent >= 20 && percent < 45) {-->
<!--                progressText.textContent = 'Экипируемся...';-->
<!--            } else if (percent >= 45 && percent < 65) {-->
<!--                progressText.textContent = 'Проводим ТО...';-->
<!--            }else if (percent >= 65 && percent < 85) {-->
<!--                progressText.textContent = 'Моем машину...';-->
<!--            } else if (percent >= 85) {-->
<!--                progressText.textContent = 'Мы готовы!';-->
<!--            }-->
<!--            if (percent === 100) {-->
<!--                clearInterval(countInterval);-->
<!--                setTimeout(function () {-->
<!--                    fadeOutnojquery(preloader);-->
<!--                }, 100);-->
<!--            }-->
<!--        }, COUNT_LOAD_TIME);-->
<!--    }-->
<!--    function fadeOutnojquery(el) {-->
<!--        el.style.opacity = 1;-->
<!--        let interhellopreloader = setInterval(function () {-->
<!--            el.style.opacity = el.style.opacity - 0.05;-->

<!--            if (el.style.opacity <= 0.05) {-->
<!--                clearInterval(interhellopreloader);-->
<!--                preloader.style.display = "none";-->
<!--            }-->
<!--        }, 16);-->
<!--    }-->

<!--    countLoad();-->
<!--</script>-->
<script>
    setTimeout(() => {
        let currentInfoPanel = null;

        // Open the panel
        document
            .querySelectorAll('[mixin="info-sphere"]')
            .forEach(function (sphere) {
                sphere.addEventListener("click", function () {
                    console.log("Info sphere clicked: " + this.id);

                    const currentSphereIdNumber = this.id.replace("sphere", "");

                    // Get the template for this info sphere
                    const template = document.querySelector(
                        "#infoPanel" + currentSphereIdNumber
                    );

                    // Get the info panel entity
                    const infoPanel = document.querySelector(
                        "#infoPanelContainer" + currentSphereIdNumber
                    );

                    console.log("Current info panel: ", infoPanel);

                    // Instantiate the new info panel from the template
                    infoPanel.appendChild(document.importNode(template.content, true));

                    const allInfoPanelContainerElements = document.querySelectorAll(
                        "[id^=infoPanelContainer]"
                    );

                    document
                        .querySelectorAll('[src="#crossIcon"]')
                        .forEach(function (cross) {
                            cross.addEventListener("click", function () {
                                allInfoPanelContainerElements.forEach((container) => {
                                    if (container.id === infoPanel.id) {
                                        container.innerHTML = "";
                                        document
                                            .querySelector("#sphere" + currentInfoPanel)
                                            .setAttribute("visible", true);
                                    }
                                });
                            });
                        });

                    allInfoPanelContainerElements.forEach((container) => {
                        if (container.id !== infoPanel.id) {
                            container.innerHTML = "";
                        }
                        this.setAttribute("visible", true);
                    });

                    // console.log("Current info panel insides: ", infoPanel.innerHTML);

                    const idNumber = currentSphereIdNumber;
                    if (currentInfoPanel) {
                        document
                            .querySelector("#sphere" + currentInfoPanel)
                            .setAttribute("visible", true);
                    }
                    // document.querySelector("#info" + idNumber).style.display = "block";
                    this.setAttribute("visible", false);
                    currentInfoPanel = idNumber;
                    console.log("Current info panel id: " + currentInfoPanel);
                });
            });
    }, 1500);
</script>

</body>
</html>